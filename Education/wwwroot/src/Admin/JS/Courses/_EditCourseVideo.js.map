{"version":3,"file":"_EditCourseVideo.js","sourceRoot":"","sources":["_EditCourseVideo.ts"],"names":[],"mappings":";;AACA,uEAAqE;AACrE,2DAAmD;AAEnD;IAqII;IACA,CAAC;IA/Hc,sCAAkB,GAAjC,UAAkC,CAAQ;QACtC,kDAAuB,CAAC,kBAAkB,CAAC,IAAI,CAAC,kDAAuB,EAAE,CAAC,CAAC,EAAE,CAAC;QAC9E,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IACvC,CAAC;IACc,iDAA6B,GAA5C;QACI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAQ,CAAC,CAAC;IAC1E,CAAC;IAAA,CAAC;IACa,wCAAoB,GAAnC;QACI,IAAI,QAAQ,GAAuB,EAAwB,CAAC;QAC5D,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,GAAG,EAAY,CAAC;QACjD,QAAQ,CAAC,aAAa,GAAG,kDAAuB,CAAC,QAAQ,CAAC;QAC1D,QAAQ,CAAC,cAAc,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAoB,CAAC;QACzE,QAAQ,CAAC,gBAAgB,GAAG,CAAC,CAAC,mBAAmB,CAAC,CAAC,GAAG,EAAY,CAAC;QACnE,QAAQ,CAAC,UAAU,GAAG,CAAC,CAAC,aAAa,CAAC,CAAC,GAAG,EAAY,CAAC;QACvD,QAAQ,CAAC,QAAQ,GAAG,CAAC,CAAC,WAAW,CAAC,CAAC,GAAG,EAAY,CAAC;QACnD,QAAQ,CAAC,UAAU,GAAG,kDAAuB,CAAC,gBAAgB,CAAC;QAC/D,QAAQ,CAAC,gBAAgB,GAAG,CAAC,CAAC,mBAAmB,CAAC,CAAC,GAAG,EAAY,CAAC;QACnE,QAAQ,CAAC,cAAc,GAAG,IAAI,CAAC,qBAAqB,CAAC,EAAE,CAAC,UAAU,CAAC;YAC/D,CAAC,CAAC,IAAI;YACN,CAAC,CAAC,KAAK,CAAC;QACZ,IAAI,QAAQ,CAAC,cAAc;YAAE,QAAQ,CAAC,UAAU,GAAG,IAAI,CAAC;;YACnD,QAAQ,CAAC,QAAQ,GAAG,EAAE,CAAC;QAC5B,OAAO,QAAQ,CAAC;IACpB,CAAC;IAEa,oCAAgB,GAA9B,UAA+B,QAAuB;QAClD,IAAI,IAAI,GAAG,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,EAAE,CAAC;QAClC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAChD,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,GAAG,CAAC,kDAAuB,CAAC,QAAQ,CAAC,CAAC;QAClE,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC7C,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QACzD,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACnD,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QACpD,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,MAAM,CAAC,kDAAuB,CAAC,kBAAkB,CAAC,IAAI,CAAC,kDAAuB,CAAQ,CAAC,CAAC;QAEjH,IAAI,QAAQ,CAAC,SAAS,EAAE;YACpB,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAA;YACtD,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,CAAA;SACvD;aAAM;YACH,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAA;YACzD,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,CAAA;SACpD;QACD,OAAO,IAAI,CAAC;IAChB,CAAC;IACa,mCAAe,GAA7B;QACI,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACnC,kDAAuB,CAAC,oBAAoB,CAAC,KAAa,CAAC,gBAAgB,CAAC,GAAG,gBAAgB,CAAC;IACrG,CAAC;IACc,4BAAQ,GAAvB,UAAwB,GAAW,EAAE,IAAwB,EAAE,QAAa,EAAE,iBAA0B;QACpG,IAAI,QAAQ,GAAG,IAAI,QAAQ,EAAE,CAAC;QAC9B,QAAQ,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QACzC,QAAQ,CAAC,MAAM,CAAC,eAAe,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACrD,QAAQ,CAAC,MAAM,CAAC,gBAAgB,EAAE,IAAI,CAAC,cAA+B,CAAC,CAAC;QACxE,QAAQ,CAAC,MAAM,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC/C,QAAQ,CAAC,MAAM,CAAC,kBAAkB,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC3D,QAAQ,CAAC,MAAM,CAAC,gBAAgB,EAAG,IAAI,CAAC,cAAgC,CAAC,CAAC;QAC1E,QAAQ,CAAC,MAAM,CAAC,kBAAkB,EAAG,IAAI,CAAC,gBAAkC,CAAC,CAAC;QAC9E,QAAQ,CAAC,MAAM,CAAC,UAAU,EAAG,IAAI,CAAC,QAA0B,CAAC,CAAC;QAC9D,QAAQ,CAAC,MAAM,CAAC,eAAe,EAAG,QAA0B,CAAC,CAAC;QAC9D,QAAQ,CAAC,MAAM,CAAC,YAAY,EAAG,IAAI,CAAC,UAA0B,CAAC,CAAC;QAChE,GAAG,CAAC,YAAY,CAAC,IAAI,EAAE,mBAAmB,CAAC,CAAC;QAC5C,CAAC,CAAC,IAAI,CAAC;YACH,GAAG,EAAE,gCAAW,CAAC,YAAY;YAC7B,IAAI,EAAE,QAAQ;YACd,MAAM,EAAE,MAAM;YACd,WAAW,EAAE,KAAK;YAClB,KAAK,EAAE,KAAK;YACZ,WAAW,EAAE,KAAK;YAClB,GAAG,EAAE,CAAC,CAAC,eAAe,CAAC,UAAA,UAAU;gBAC7B,mBAAmB,CAAC,sBAAsB,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC;oBAC1D,KAAK,EAAE,UAAU;oBACjB,QAAQ,EAAE;wBACN,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,CAAC;oBACtB,CAAC;oBACD,MAAM,EAAE;wBACJ,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC;oBACnB,CAAC;iBACJ,CAAC,CAAC;YACP,CAAC,CAAC;SACL,CAAC;aACG,IAAI,CAAC;YACF,CAAC,CAAC,MAAM,CAAC;gBACL,OAAO,EAAE,uBAAuB;aACnC,CAAC,CAAC;YACH,kDAAuB,CAAC,gBAAgB,GAAG,EAAU,CAAC;YACtD,iBAAiB,EAAE,CAAC;QACxB,CAAC,CAAC;aACD,MAAM,CAAC;YACJ,GAAG,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;QAC5B,CAAC,CAAC;aACD,KAAK,CAAC,UAAA,CAAC;YACJ,CAAC,CAAC,MAAM,CAAC;gBACL,OAAO,EAAE,2CAA2C;aACvD,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACX,CAAC;IAEa,uCAAmB,GAAjC;QACI,IAAI,UAAU,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC;YACvB,IAAI,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;YAClB,UAAU,CAAC,UAAU,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAC5C,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,KAAK,EAAE;gBAAE,OAAO;YAC3C,IAAI,IAAI,GAAG,UAAU,CAAC,oBAAoB,EAAE,CAAC;YAC7C,IAAI,QAAQ,GAAG,CAAC,CAAC;YACjB,IAAK,IAAI,CAAC,UAAmB,CAAC,IAAI,IAAI,SAAS,EAAE;gBAC5C,IAAI,CAAC,UAAmB,CAAC,kBAAkB,EAAE,CAAC,gBAAgB,GAAG,UAAA,CAAC;oBAC/D,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAE,CAAC,CAAC,MAA2B,CAAC,QAAQ,CAAC,CAAC;oBAC/D,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC;oBAC9B,UAAU,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,UAAU,CAAC,iBAAiB,CAAC,GAAG,EAAC,IAAI,CAAC,CAAC,CAAC;gBACrF,CAAC,CAAC;aACL;iBACI;gBACD,IAAI,CAAC,UAAU,GAAG,EAAS,CAAC;gBAC5B,UAAU,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,UAAU,CAAC,iBAAiB,CAAC,GAAG,EAAC,IAAI,CAAC,CAAC,CAAC;aACnF;QACN,CAAC,CAAC,CAAC;IACP,CAAC;IACa,wBAAI,GAAlB;QACI,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC;YACrB,MAAM,EAAE,qBAAqB;SAEhC,CAAC,CAAC;QACH,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,6BAA6B,EAAE,CAAC;IACzC,CAAC;IAnIc,6BAAS,GAAG,CAAC,CAAC;IACd,kCAAc,GAAG,CAAC,CAAC,aAAa,CAAC,CAAC;IAClC,0CAAsB,GAAG,CAAC,CAAC,8BAA8B,CAAC,CAAC;IAC3D,8BAAU,GAAG,CAAC,CAAC,gBAAgB,CAAC,CAAC;IAClC,qCAAiB,GAAG,CAAC,CAAC,iBAAiB,CAAC,CAAC;IACxC,yCAAqB,GAAG,CAAC,CAAC,gBAAgB,CAA6B,CAAC;IAyBxE,mCAAe,GAAW,CAAC,CAAC,6BAA6B,CAAC,CAAC;IAwG9E,0BAAC;CAAA,AAvID,IAuIC;AAvIY,kDAAmB","sourcesContent":["import { VideoTutorial, VideoFormData_Edit } from \"../Shared/Interfaces\";\r\nimport { MainObjectOperForCourse } from \"./_MainObjectOperForCourse\";\r\nimport { CommonFuncs } from \"./SharedCoursesFuncs\";\r\n\r\nexport class EditCourseVideoOper{\r\n    private static formCount = 1;\r\n    private static VideoUploadBtn = $(\"#Video_Edit\");\r\n    private static VideoUploadProgressbar = $(\"#VideoUploadProgressbar_Edit\");\r\n    private static EditedForm = $('#EditVideoForm');\r\n    public static isVideoChangedInp = $('#IsVideoChanged');\r\n    private static youtubeChoiceRadioBtn = $(\"#youtubeChoice\") as JQuery<HTMLInputElement>;\r\n    private static OnVideoInputChange(e: Event) {\r\n        MainObjectOperForCourse.OnVideoInputChange.bind(MainObjectOperForCourse, e)();\r\n        this.isVideoChangedInp.val('true');\r\n    }\r\n    private static HandleOnVideoUploadBtnClicked() {\r\n        this.VideoUploadBtn.change(this.OnVideoInputChange.bind(this) as any);    \r\n    };\r\n    private static GetEditVideoFormData(): VideoFormData_Edit{\r\n        let formData: VideoFormData_Edit = {} as VideoFormData_Edit;\r\n        formData.Id_Edit = $(\"#Id_Edit\").val() as string;\r\n        formData.CourseId_Edit = MainObjectOperForCourse.courseId;\r\n        formData.IsVideoChanged = this.isVideoChangedInp.val() as any as boolean;\r\n        formData.Description_Edit = $(\"#Description_Edit\").val() as string;\r\n        formData.Title_Edit = $(\"#Title_Edit\").val() as string;\r\n        formData.Url_Edit = $(\"#Url_Edit\").val() as string;\r\n        formData.Video_Edit = MainObjectOperForCourse.LastUpoladedFile;\r\n        formData.VideoNumber_Edit = $(\"#VideoNumber_Edit\").val() as number;\r\n        formData.IsYoutube_Edit = this.youtubeChoiceRadioBtn.is(\":checked\")\r\n            ? true\r\n            : false;\r\n        if (formData.IsYoutube_Edit) formData.Video_Edit = null;\r\n        else formData.Url_Edit = \"\";\r\n        return formData;\r\n    }\r\n    private static SaveEditFormBtn: JQuery = $('#EditSubmitVideoTutorialBtn');\r\n    public static GetEditVideoForm(formData: VideoTutorial) {\r\n        let form = $('#EditVideo').show();\r\n        form.find('#Id_Edit').val(formData.id).prop('');\r\n        form.find('#CourseId_Edit').val(MainObjectOperForCourse.courseId);\r\n        form.find('#Title_Edit').val(formData.title);\r\n        form.find('#Description_Edit').val(formData.description);\r\n        form.find('#Duration_Edit').val(formData.duration);\r\n        form.find('#VideoNumber_Edit').val(formData.number);\r\n        form.find('#Video_Edit').change(MainObjectOperForCourse.OnVideoInputChange.bind(MainObjectOperForCourse) as any);\r\n\r\n        if (formData.isYoutube) {\r\n            form.find('#youtubeChoice').prop('checked', 'checked')\r\n            form.find('#notyoutubeChoice').removeProp('checked')\r\n        } else {\r\n            form.find('#notyoutubeChoice').prop('checked', 'checked')\r\n            form.find('#youtubeChoice').removeProp('checked')\r\n        }\r\n        return form; \r\n    }\r\n    public static ResetVideoInput() {\r\n        this.isVideoChangedInp.val('false');\r\n        (MainObjectOperForCourse.CourseDataController.Model as any)['VideoTextTitle'] = \"قم باختيار ملف\";\r\n    }\r\n    private static SendData(btn: JQuery, data: VideoFormData_Edit, duration: any, executeFuncOnDone:()=>void) {\r\n        let formData = new FormData();\r\n        formData.append(\"Id_Edit\", data.Id_Edit);\r\n        formData.append(\"CourseId_Edit\", data.CourseId_Edit);\r\n        formData.append(\"IsVideoChanged\", data.IsVideoChanged as any as string);\r\n        formData.append(\"Title_Edit\", data.Title_Edit);\r\n        formData.append(\"Description_Edit\", data.Description_Edit);\r\n        formData.append(\"IsYoutube_Edit\", (data.IsYoutube_Edit as any) as string);\r\n        formData.append(\"VideoNumber_Edit\", (data.VideoNumber_Edit as any) as string);\r\n        formData.append(\"Url_Edit\", (data.Url_Edit as any) as string);\r\n        formData.append(\"Duration_Edit\", (duration as any) as string);\r\n        formData.append(\"Video_Edit\", (data.Video_Edit as any) as File);\r\n        btn.pendingState(true, \"fa-check-circle-o\");\r\n        $.ajax({\r\n            url: CommonFuncs.EditVideoUrl,\r\n            data: formData,\r\n            method: \"POST\",\r\n            processData: false,\r\n            cache: false,\r\n            contentType: false,\r\n            xhr: $.AjaxXHRProgress(percentage => {\r\n                EditCourseVideoOper.VideoUploadProgressbar.show().progressbar({\r\n                    value: percentage,\r\n                    complete: function () {\r\n                        $(this).fadeOut();\r\n                    },\r\n                    create: function () {\r\n                        $(this).show();\r\n                    }\r\n                });\r\n            })\r\n        })\r\n            .done(() => {\r\n                $.notify({\r\n                    message: \"تم تعديل الفديو بنجاح\"\r\n                });\r\n                MainObjectOperForCourse.LastUpoladedFile = {} as File;\r\n                executeFuncOnDone();\r\n            })\r\n            .always(() => {\r\n                btn.pendingState(false);\r\n            })\r\n            .catch(e => {\r\n                $.notify({\r\n                    message: \"لم يتم تعديل الفديو,حدثت مشكلة فى السيرفر\"\r\n                });\r\n            });\r\n    }\r\n    public static executeFuncOnDone: (btn: JQuery, newData: VideoFormData_Edit) => ()=>void;\r\n    public static HandleOnVideoEdited() {\r\n        let mainObject = this;\r\n        this.SaveEditFormBtn.click(function () {\r\n            let btn = $(this);\r\n            mainObject.EditedForm = btn.parents('form');\r\n            if (!mainObject.EditedForm.valid()) return;\r\n            let data = mainObject.GetEditVideoFormData();            \r\n            let duration = 0;\r\n            if ((data.Video_Edit as File).name != undefined) {\r\n                (data.Video_Edit as File).toHtmlVideoElement().onloadedmetadata = e => {\r\n                    duration = Math.floor((e.target as HTMLVideoElement).duration);\r\n                    data.Duration_Edit = duration;\r\n                    mainObject.SendData(btn, data, duration, mainObject.executeFuncOnDone(btn,data));\r\n                };\r\n            } \r\n            else {\r\n                data.Video_Edit = \"\" as any;\r\n                mainObject.SendData(btn, data, duration, mainObject.executeFuncOnDone(btn,data));\r\n             }          \r\n        });\r\n    }\r\n    public static Main() {\r\n        this.EditedForm.validate({\r\n            ignore: '#Video_Edit,:hidden',\r\n            //ignoreTitle: '#Video_Edit'\r\n        });\r\n        this.HandleOnVideoEdited();\r\n        this.HandleOnVideoUploadBtnClicked();\r\n    }\r\n    private constructor() {\r\n    }\r\n}"]}